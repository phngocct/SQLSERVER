SELECT *
FROM NHANVIEN
ORDER BY  MANV

SELECT *
FROM NHANVIEN
ORDER BY CONVERT(INT, MANV)

--B3
--Danh sách những nhân viên (HONV, TENLOT, TENNV, DCHI) có trên 2 thân nhân,
--Dữ liệu chột TENNV có ký tự thứ 2 được viết in hoa, các ký tự còn lại viết
--thường( ví dụ: kHanh)
SELECT MA_NVIEN,HONV, TENLOT, 
	LOWER(left(TENNV,1))+ UPPER(SUBSTRING(TENNV,2,1)) + lower(RIGHT(TENNV,LEN(TENNV)-2)) as N'TÊN',
	CHARINDEX(' ',DCHI)
	SUBSTRING(DCHI,CHARINDEX(' ',DCHI), ) , 
	COUNT(TENTN) AS N'Số NV'
FROM THANNHAN a, NHANVIEN b
WHERE a.MA_NVIEN=b.MANV
GROUP BY MA_NVIEN,HONV, TENLOT, TENNV,DCHI
HAVING COUNT(TENTN)>2

DECLARE @PBMAX TABLE (
	PHONG int,
	SOLUONG int
)
INSERT INTO @PBMAX
	SELECT PHG, COUNT(MANV)
	FROM NHANVIEN
	GROUP BY PHG

SELECT PHONG, tenphg,HONV+ ' '+TENLOT+ ' '+TENNV AS N'Tên Trưởng Phòng', SOLUONG
FROM @PBMAX a, PHONGBAN b, NHANVIEN c
WHERE a.PHONG=b.MAPHG
	AND b.TRPHG=c.MANV
	AND SOLUONG = 
	(SELECT MAX(SOLUONG)
	FROM @PBMAX
	)
	
SELECT a.PHG, TENPHG, c.HONV,c.TENLOT,c.TENNV,COUNT(a.MANV) AS N'Số nv'
FROM NHANVIEN a, PHONGBAN b, NHANVIEN c
WHERE a.PHG=b.MAPHG
	AND c.MANV=b.TRPHG
GROUP BY a.PHG,TENPHG,c.HONV,c.TENLOT,c.TENNV
